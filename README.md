# 双积分式电压表仿真系统

使用Matlab R2022a对双积分式电压表进行仿真测试，分析各种非理想因素对测量精度的影响。

## 项目概述

本仿真系统实现了双积分式电压表的完整仿真模型，重点研究以下四个方面对测量结果的影响：

1. **基准电压V_ref的偏差**对测量结果的影响
2. **时钟周期T_clk的量化误差**对测量结果的影响
3. **积分器RC的非理想因素**（零点偏移、偏置电压、电容漏电）对测量结果的影响
4. **工频干扰信号**对测量结果的影响

## 仿真结论

通过仿真验证了以下四个关键结论：

1. **基准电压稳定性影响**：基准电压的稳定性显著影响双积分式电压表的测量精度，且稳定性越高双积分式电压表的测量精度越高

2. **时钟频率影响**：在积分时间T_1一定的条件下，提高时钟频率减小T_{clk}有利于降低量化误差，提高测量分辨率

3. **积分时间影响**：如果积分器的RC处于非理想状态，积分时间越长对于测试结果的影响更明显

4. **工频干扰抑制**：当积分时间T_1取工频周期的整数倍时，工频干扰被完全抵消

## 文件结构

```
Dual-Slope DVM/
├── main_simulation.m          # 主仿真脚本（入口）
├── dual_slope_dvm.m           # 双积分式电压表核心函数
├── simulate_vref_error.m      # 基准电压偏差仿真
├── simulate_clock_error.m     # 时钟量化误差仿真
├── simulate_nonideal_rc.m     # RC非理想因素仿真
├── simulate_powerline_noise.m # 工频干扰仿真
├── plot_results.m             # 综合结果可视化函数
├── README.md                  # 本文件
├── figures/                   # 图表输出目录（自动创建）
└── results_*.xlsx             # 仿真结果表格（自动生成）
```

## 使用方法

### 快速开始

1. 确保已安装 **Matlab R2022a** 或更高版本
2. 将所有文件放在同一目录下
3. 在Matlab命令窗口中运行：

```matlab
main_simulation
```

### 单独运行各模块

如果需要单独运行某个仿真模块：

```matlab
% 基准电压偏差仿真
results_vref = simulate_vref_error();

% 时钟量化误差仿真
results_clock = simulate_clock_error();

% RC非理想因素仿真
results_rc = simulate_nonideal_rc();

% 工频干扰仿真
results_noise = simulate_powerline_noise();

% 综合可视化
plot_results();
```

## 参数配置

### 默认仿真参数

各仿真模块的默认参数可以在相应的`.m`文件中修改：

- **输入电压范围**: 0-5V
- **基准电压V_ref**: 5V（标准值）
- **积分时间T_1**: 100ms（可配置为工频周期整数倍）
- **时钟频率f_clk**: 1MHz（对应T_clk = 1μs）
- **工频频率**: 50Hz（周期20ms）

### 非理想因素参数范围

- **零点偏移V_offset**: 0-10mV
- **偏置电压V_bias**: 0-5mV
- **电容漏电电阻R_leak**: 1MΩ-100MΩ
- **RC时间常数偏差**: ±1%到±10%

### 修改参数

在相应的仿真函数中，可以修改以下参数：

```matlab
% 在 simulate_vref_error.m 中
V_in = 2.5;              % 输入电压
V_ref_nominal = 5.0;     % 标称基准电压
V_ref_deviation_percent = (-1:0.05:1)';  % 偏差范围

% 在 simulate_clock_error.m 中
f_clk_min = 100e3;       % 最小时钟频率
f_clk_max = 10e6;        % 最大时钟频率

% 在 simulate_nonideal_rc.m 中
T1_values = (20:10:200) * 1e-3;  % 积分时间范围
V_offset_values = [0, 2e-3, 5e-3, 10e-3];  % 零点偏移值

% 在 simulate_powerline_noise.m 中
f_powerline = 50;        % 工频频率
A_noise = 0.1;           % 干扰幅度
```

## 输出文件说明

### 结果表格（Excel格式）

- `results_vref_error.xlsx` - 基准电压偏差仿真结果
- `results_clock_error.xlsx` - 时钟量化误差仿真结果
- `results_nonideal_rc.xlsx` - RC非理想因素综合结果
- `results_nonideal_rc_offset.xlsx` - 零点偏移详细结果
- `results_nonideal_rc_bias.xlsx` - 偏置电压详细结果
- `results_nonideal_rc_leak.xlsx` - 电容漏电详细结果
- `results_powerline_noise.xlsx` - 工频干扰仿真结果

### 图表文件（PNG格式）

所有图表保存在 `figures/` 目录下，每张图对应一个独立的Figure窗口：

#### 结论1：基准电压稳定性影响（4张图）

**测试条件：**
- 输入电压：V_in = 2.5V（固定）
- 基准电压：V_ref = 5.0V ± 1%（偏差范围：-1% 到 +1%，步长0.05%）
- 测量换算：使用标称V_ref = 5.0V（未进行参考电压校准）
- 积分时间：T_1 = 100ms（固定）
- 时钟频率：f_clk = 1MHz（固定）
- 其他条件：无零点偏移、无偏置电压、无漏电、无干扰

**生成的图表：**

1. **`vref_error_vs_deviation.png`** - 基准电压偏差对测量误差的影响
   - X轴：基准电压偏差（%）
   - Y轴：测量误差（mV）
   - 显示基准电压偏差与测量误差的线性关系

2. **`vref_relative_error.png`** - 基准电压偏差对相对误差的影响
   - X轴：基准电压偏差（%）
   - Y轴：相对误差（%）
   - 显示基准电压偏差对相对误差百分比的影响

3. **`vref_stability_vs_accuracy.png`** - 基准电压稳定性与测量精度的关系
   - 双Y轴图
   - 左Y轴：基准电压稳定性指标 |偏差|（%）
   - 右Y轴：测量精度指标 相对误差（%）
   - X轴：基准电压偏差（%）
   - 直观展示稳定性与精度的对应关系

4. **`vref_linear_relationship.png`** - 基准电压偏差与测量误差的线性关系
   - 散点图显示仿真数据点
   - 线性拟合直线
   - 验证线性关系的准确性

#### 结论2：时钟频率对量化误差和分辨率的影响（6张图）

**测试条件：**
- 输入电压：V_in = 2.5V（固定）
- 基准电压：V_ref = 5.0V（固定）
- 积分时间：T_1 = 100ms（固定）
- 时钟频率：f_clk = 100kHz ~ 10MHz（对数分布，50个测试点）
- 时钟周期：T_clk = 10μs ~ 0.1μs（对应）
- 其他条件：无零点偏移、无偏置电压、无漏电、无干扰

**生成的图表：**

1. **`clock_freq_vs_quantization_error.png`** - 时钟频率对量化误差的影响
   - X轴：时钟频率（MHz，对数坐标）
   - Y轴：量化误差（mV）
   - 显示提高时钟频率可降低量化误差

2. **`clock_period_vs_quantization_error.png`** - 时钟周期对量化误差的影响
   - X轴：时钟周期 T_clk（μs，对数坐标）
   - Y轴：量化误差（mV）
   - 显示减小时钟周期可降低量化误差

3. **`clock_freq_vs_resolution.png`** - 时钟频率对测量分辨率的影响
   - X轴：时钟频率（MHz，对数坐标）
   - Y轴：测量分辨率（mV）
   - 显示提高时钟频率可提高测量分辨率

4. **`clock_period_vs_resolution.png`** - 时钟周期对测量分辨率的影响
   - X轴：时钟周期 T_clk（μs，对数坐标）
   - Y轴：测量分辨率（mV）
   - 显示减小时钟周期可提高测量分辨率

5. **`clock_freq_vs_relative_error.png`** - 时钟频率对相对误差的影响
   - X轴：时钟频率（MHz，对数坐标）
   - Y轴：相对误差（%）
   - 显示时钟频率对整体测量精度的影响

6. **`clock_resolution_comparison.png`** - 不同时钟频率下的测量分辨率对比
   - 柱状图，选择6个典型频率点（100kHz, 230kHz, 600kHz, 1.53MHz, 3.91MHz, 10MHz）
   - Y轴：测量分辨率（mV）
   - 直观对比不同频率下的分辨率差异

#### 结论3：RC非理想因素对测量结果的影响（6张图）

**测试条件：**
- 输入电压：V_in = 2.5V（固定）
- 基准电压：V_ref = 5.0V（固定）
- 时钟频率：f_clk = 1MHz（固定）
- 积分时间：T_1 = 20ms ~ 200ms（步长10ms，共19个测试点）
- 积分器参数：R = 100kΩ, C = 1μF
- 零点偏移：V_offset = 0, 2mV, 5mV, 10mV（4个值）
- 偏置电压：V_bias = 0, 1mV, 2.5mV, 5mV（4个值）
- 漏电电阻：R_leak = inf, 100MΩ, 10MΩ, 1MΩ（4个值）
- 其他条件：无干扰

**生成的图表：**

1. **`rc_offset_error.png`** - 零点偏移对测量误差的影响
   - X轴：积分时间 T_1（ms）
   - Y轴：测量误差（mV）
   - 4条曲线对应4个不同的零点偏移值（0, 2mV, 5mV, 10mV）
   - 显示误差随积分时间线性增长

2. **`rc_bias_error.png`** - 偏置电压对测量误差的影响
   - X轴：积分时间 T_1（ms）
   - Y轴：测量误差（mV）
   - 4条曲线对应4个不同的偏置电压值（0, 1mV, 2.5mV, 5mV）
   - 显示误差随积分时间线性增长

3. **`rc_leak_error.png`** - 电容漏电对测量误差的影响
   - X轴：积分时间 T_1（ms）
   - Y轴：测量误差（mV）
   - 4条曲线对应4个不同的漏电电阻值（无漏电, 100MΩ, 10MΩ, 1MΩ）
   - 显示漏电对误差的影响随积分时间增长

4. **`rc_combined_error.png`** - 非理想因素叠加效应（误差累积）
   - X轴：积分时间 T_1（ms）
   - Y轴：总测量误差（mV）
   - 选择中等程度的非理想因素叠加（V_offset=5mV, V_bias=2.5mV, R_leak=100MΩ）
   - 显示所有非理想因素共同作用时的误差累积趋势

5. **`rc_error_growth.png`** - 不同非理想因素的误差增长率
   - 柱状图对比三种非理想因素的误差增长倍数
   - X轴：非理想因素类型（零点偏移、偏置电压、电容漏电）
   - Y轴：误差增长倍数（T_1=200ms时的误差 / T_1=20ms时的误差）
   - 显示不同非理想因素对积分时间的敏感程度

6. **`rc_error_slope.png`** - 不同非理想因素的误差斜率对比
   - 分组柱状图
   - X轴：非理想因素强度（中等、较大、最大）
   - Y轴：误差斜率（mV/ms）
   - 显示不同强度下各非理想因素的误差增长速率

#### 结论4：工频干扰抑制效果（6张图）

**测试条件：**
- 输入电压：V_in = 2.5V（固定）
- 基准电压：V_ref = 5.0V（固定）
- 时钟频率：f_clk = 1MHz（固定）
- 工频频率：f_powerline = 50Hz（周期T_50Hz = 20ms）
- 干扰幅度：A_noise = 100mV
- 积分时间：
  - 整数倍周期：T_1 = 20ms, 40ms, 60ms, 80ms, 100ms（5个值）
  - 非整数倍周期：T_1 = 22ms, 30ms, 46ms, 74ms, 98ms（5个值）
- 干扰相位：φ = 0, π/4, π/2, 3π/4, π（5个相位，取平均值）
- 其他条件：无零点偏移、无偏置电压、无漏电

**生成的图表：**

1. **`powerline_error_vs_ratio.png`** - 积分时间与工频周期比值对测量误差的影响
   - X轴：T_1 / T_50Hz（积分时间与工频周期的比值）
   - Y轴：测量误差（mV）
   - 绿色圆点：整数倍周期（误差接近零）
   - 红色圆点：非整数倍周期（存在明显误差）
   - 标注整数倍点的倍数

2. **`powerline_rejection_ratio.png`** - 不同积分时间下的工频干扰抑制比
   - 柱状图
   - X轴：积分时间（标注为T_1/T_50Hz的倍数）
   - Y轴：干扰抑制比（干扰幅度/测量误差）
   - 绿色柱：整数倍周期（抑制比极高）
   - 蓝色柱：非整数倍周期（抑制比较低）

3. **`powerline_time_domain.png`** - 工频干扰时域波形对比
   - X轴：时间（ms）
   - Y轴：干扰信号幅度（V）
   - 绿色曲线：T_1 = 40ms（2倍周期，整数倍）
   - 红色曲线：T_1 = 30ms（1.5倍周期，非整数倍）
   - 显示整数倍周期时干扰信号完整周期积分

4. **`powerline_error_range.png`** - 测量误差范围（不同相位）
   - 误差棒图
   - X轴：T_1 / T_50Hz
   - Y轴：测量误差（mV）
   - 误差棒显示不同相位下的误差范围（最小-最大）
   - 绿色圆点标记整数倍周期点

5. **`powerline_spectrum.png`** - 工频干扰频谱分析
   - X轴：频率（Hz，0-200Hz范围）
   - Y轴：幅度（对数坐标）
   - 绿色曲线：T_1 = 40ms（整数倍）的FFT频谱
   - 红色曲线：T_1 = 30ms（非整数倍）的FFT频谱
   - 显示整数倍周期时50Hz干扰被有效抑制

6. **`powerline_comparison.png`** - 整数倍 vs 非整数倍周期干扰抑制对比
   - 柱状图
   - X轴：周期类型（整数倍周期、非整数倍周期）
   - Y轴：平均测量误差（mV）
   - 数值标签显示具体误差值
   - 直观对比两种情况的干扰抑制效果

### 文本报告

- `simulation_report.txt` - 仿真执行报告，包含执行时间、文件列表和结论总结

## 核心算法说明

### 双积分式电压表工作原理

1. **第一阶段积分**（0到T_1）：
   - 对输入电压V_in进行积分
   - 考虑非理想因素：偏置电压、漏电、干扰信号
   - 计算积分器输出电压V_out1

2. **第二阶段积分**（T_1到T_1+T_2）：
   - 对基准电压-V_ref进行反向积分
   - 直到V_out回到零点（考虑零点偏移）
   - 使用时钟量化计算T_2

3. **计算测量结果**：
   - V_measured = V_ref * (T_2 / T_1)
   - error = V_measured - V_in

### 非理想因素建模

- **零点偏移**：影响第二阶段的比较器阈值
- **偏置电压**：在第一阶段积分时叠加到输入信号
- **电容漏电**：通过漏电电阻R_leak产生漏电流，影响积分精度
- **时钟量化**：T_2必须是时钟周期的整数倍，产生量化误差
- **工频干扰**：叠加在输入信号上的50Hz正弦干扰

## 技术特点

1. **模块化设计**：各仿真模块独立，便于单独运行和调试
2. **参数可配置**：所有关键参数可在脚本中轻松修改
3. **详细可视化**：每个模块生成多子图，直观展示结论
4. **数据导出**：结果以Excel格式保存，便于进一步分析
5. **兼容性**：代码兼容Matlab R2022a及以上版本

## 注意事项

1. 首次运行会自动创建 `figures/` 输出目录
2. 仿真可能需要几分钟时间，请耐心等待
3. 确保有足够的磁盘空间保存结果文件
4. 如果遇到内存不足，可以减少仿真点数或参数范围

## 故障排除

### 问题：找不到函数

**解决方案**：确保所有`.m`文件都在Matlab路径中，或使用`addpath`添加当前目录：

```matlab
addpath(pwd);
```

### 问题：Excel文件无法写入

**解决方案**：确保文件未被其他程序（如Excel）打开，或检查写入权限

### 问题：图表显示异常

**解决方案**：确保Matlab图形系统正常工作，尝试更新图形驱动

## 版本信息

- **版本**: 1.0
- **Matlab版本要求**: R2022a或更高
- **最后更新**: 2024

## 作者

双积分式电压表仿真系统

## 许可证

本项目仅供学习和研究使用。

